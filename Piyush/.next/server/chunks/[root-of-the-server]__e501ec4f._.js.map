{"version":3,"sources":["../../../../Piyush/src/lib/api-utils.ts","../../../../Piyush/src/lib/rate-limit.ts","../../../../Piyush/node_modules/uuid/dist-node/native.js","../../../../Piyush/node_modules/uuid/dist-node/rng.js","../../../../Piyush/node_modules/uuid/dist-node/regex.js","../../../../Piyush/node_modules/uuid/dist-node/validate.js","../../../../Piyush/node_modules/uuid/dist-node/stringify.js","../../../../Piyush/node_modules/uuid/dist-node/v4.js"],"sourcesContent":["import { NextResponse } from 'next/server';\n\nexport interface ApiResponse<T = any> {\n    success: boolean;\n    data?: T;\n    error?: string;\n    meta?: any;\n}\n\nexport function apiSuccess<T>(data: T, meta?: any): NextResponse<ApiResponse<T>> {\n    return NextResponse.json(\n        {\n            success: true,\n            data,\n            meta,\n        },\n        { status: 200 }\n    );\n}\n\nexport function apiError(\n    message: string,\n    statusCode: number = 400,\n    details?: any\n): NextResponse<ApiResponse> {\n    return NextResponse.json(\n        {\n            success: false,\n            error: message,\n            meta: details,\n        },\n        { status: statusCode }\n    );\n}\n\nexport async function handleApiError(error: unknown): Promise<NextResponse<ApiResponse>> {\n    console.error('API Error:', error);\n\n    if (error instanceof Error) {\n        return apiError(error.message, 500);\n    }\n\n    return apiError('An unexpected error occurred', 500);\n}\n","export interface RateLimitConfig {\n    interval: number; // in milliseconds\n    uniqueTokenPerInterval: number; // Max requests per interval\n}\n\nexport interface RateLimitResult {\n    success: boolean;\n    limit: number;\n    remaining: number;\n    reset: number;\n}\n\nconst LRU_CACHE_SIZE = 500;\n\nexport class RateLimiter {\n    private tokenCache: Map<string, number[]>;\n    private config: RateLimitConfig;\n\n    constructor(config: RateLimitConfig) {\n        this.config = config;\n        this.tokenCache = new Map();\n    }\n\n    public check(token: string): RateLimitResult {\n        const NOW = Date.now();\n        const tokenCount = this.tokenCache.get(token) || [0];\n\n        // Clean up old requests inside the array\n        // Store format: [unused_index, request_time1, request_time2, ...] \n        // Actually simpler: just store timestamps of requests.\n\n        let currentUsage = this.tokenCache.get(token) || [];\n\n        // Filter out timestamps older than the interval\n        currentUsage = currentUsage.filter(timestamp => NOW - timestamp < this.config.interval);\n\n        const isRateLimited = currentUsage.length >= this.config.uniqueTokenPerInterval;\n\n        if (!isRateLimited) {\n            currentUsage.push(NOW);\n            this.tokenCache.set(token, currentUsage);\n\n            // Simple LRU-like cleanup if too big\n            if (this.tokenCache.size > LRU_CACHE_SIZE) {\n                const firstKey = this.tokenCache.keys().next().value;\n                if (firstKey) this.tokenCache.delete(firstKey);\n            }\n        }\n\n        return {\n            success: !isRateLimited,\n            limit: this.config.uniqueTokenPerInterval,\n            remaining: Math.max(0, this.config.uniqueTokenPerInterval - currentUsage.length),\n            reset: NOW + this.config.interval\n        };\n    }\n}\n\n// Global instance for simple in-memory caching across hot-reloads in dev\n// In production serverless/edge, this resets per instance start.\nconst globalLimiter = new RateLimiter({\n    interval: 60 * 1000, // 60 seconds\n    uniqueTokenPerInterval: 20, // 20 requests per minute\n});\n\nexport default globalLimiter;\n","import { randomUUID } from 'node:crypto';\nexport default { randomUUID };\n","import { randomFillSync } from 'node:crypto';\nconst rnds8Pool = new Uint8Array(256);\nlet poolPtr = rnds8Pool.length;\nexport default function rng() {\n    if (poolPtr > rnds8Pool.length - 16) {\n        randomFillSync(rnds8Pool);\n        poolPtr = 0;\n    }\n    return rnds8Pool.slice(poolPtr, (poolPtr += 16));\n}\n","export default /^(?:[0-9a-f]{8}-[0-9a-f]{4}-[1-8][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}|00000000-0000-0000-0000-000000000000|ffffffff-ffff-ffff-ffff-ffffffffffff)$/i;\n","import REGEX from './regex.js';\nfunction validate(uuid) {\n    return typeof uuid === 'string' && REGEX.test(uuid);\n}\nexport default validate;\n","import validate from './validate.js';\nconst byteToHex = [];\nfor (let i = 0; i < 256; ++i) {\n    byteToHex.push((i + 0x100).toString(16).slice(1));\n}\nexport function unsafeStringify(arr, offset = 0) {\n    return (byteToHex[arr[offset + 0]] +\n        byteToHex[arr[offset + 1]] +\n        byteToHex[arr[offset + 2]] +\n        byteToHex[arr[offset + 3]] +\n        '-' +\n        byteToHex[arr[offset + 4]] +\n        byteToHex[arr[offset + 5]] +\n        '-' +\n        byteToHex[arr[offset + 6]] +\n        byteToHex[arr[offset + 7]] +\n        '-' +\n        byteToHex[arr[offset + 8]] +\n        byteToHex[arr[offset + 9]] +\n        '-' +\n        byteToHex[arr[offset + 10]] +\n        byteToHex[arr[offset + 11]] +\n        byteToHex[arr[offset + 12]] +\n        byteToHex[arr[offset + 13]] +\n        byteToHex[arr[offset + 14]] +\n        byteToHex[arr[offset + 15]]).toLowerCase();\n}\nfunction stringify(arr, offset = 0) {\n    const uuid = unsafeStringify(arr, offset);\n    if (!validate(uuid)) {\n        throw TypeError('Stringified UUID is invalid');\n    }\n    return uuid;\n}\nexport default stringify;\n","import native from './native.js';\nimport rng from './rng.js';\nimport { unsafeStringify } from './stringify.js';\nfunction _v4(options, buf, offset) {\n    options = options || {};\n    const rnds = options.random ?? options.rng?.() ?? rng();\n    if (rnds.length < 16) {\n        throw new Error('Random bytes length must be >= 16');\n    }\n    rnds[6] = (rnds[6] & 0x0f) | 0x40;\n    rnds[8] = (rnds[8] & 0x3f) | 0x80;\n    if (buf) {\n        offset = offset || 0;\n        if (offset < 0 || offset + 16 > buf.length) {\n            throw new RangeError(`UUID byte range ${offset}:${offset + 15} is out of buffer bounds`);\n        }\n        for (let i = 0; i < 16; ++i) {\n            buf[offset + i] = rnds[i];\n        }\n        return buf;\n    }\n    return unsafeStringify(rnds);\n}\nfunction v4(options, buf, offset) {\n    if (native.randomUUID && !buf && !options) {\n        return native.randomUUID();\n    }\n    return _v4(options, buf, offset);\n}\nexport default v4;\n"],"names":[],"mappings":"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","ignoreList":[2,3,4,5,6,7]}